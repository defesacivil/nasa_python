# AnÃ¡lise de Risco HidrolÃ³gico com Dados INMET

> EXECUCAO DENTRO DO NOTEBOOK PYTHON NO SOFTWARE ARCGIS PRO\
VIDE CREDENCIAIS DE ACESSO PARA EXECUCAO DO PROJETO

## 1. Objetivo
Este projeto utiliza dados de chuva em tempo real da API do INMET e dados geoespaciais de suscetibilidade a deslizamentos para gerar um mapa de anÃ¡lise de perigo (Nowcast). O processo Ã© executado dentro de um Notebook no ambiente ArcGIS Pro.

## 2. Estrutura de Pastas Esperada
Para que o script funcione corretamente, a organizaÃ§Ã£o das suas pastas e arquivos deve seguir a estrutura abaixo. O script foi projetado para ser executado a partir da pasta principal do projeto, onde o arquivo .aprx estÃ¡ localizado.

## 2. Estrutura de Pastas Esperada

Para que o script funcione corretamente, a organizaÃ§Ã£o das suas pastas e arquivos deve seguir a estrutura abaixo. O script foi projetado para ser executado a partir da pasta principal do projeto.

```
ğŸ“ Meu_Projeto_Arc/
 â”‚
 â”œâ”€â”€ ğŸ“„ Meu_Projeto_Hidrologico.aprx
 â”œâ”€â”€ ğŸ“„ Seu_Notebook.ipynb
 â”œâ”€â”€ ğŸ“„ estacoes_mg_completo.csv
 â”œâ”€â”€ ğŸ—ƒï¸ Meu_Projeto_Hidrologico.gdb
 â”œâ”€â”€ ğŸ—ƒï¸ Meu_Projeto_Hidrologico.tbx
 â”‚
 â”œâ”€â”€ ğŸ“ data/
 â”‚   â”‚
 â”‚   â””â”€â”€ ğŸ—ƒï¸ MG-HIDRO-DATA.gdb
 â”‚
 â””â”€â”€ ğŸ“ logs/
     â”‚
     â””â”€â”€ ğŸ“„ LHASA_MG.log (serÃ¡ criado na 1Âª execuÃ§Ã£o)
```

## 3. PrÃ©-requisitos
Software: ArcGIS Pro instalado.

Dados de Entrada:

Um arquivo estacoes_mg_completo.csv com as colunas DC_NOME e CD_ESTACAO.

Dentro do geodatabase MG-HIDRO-DATA.gdb, vocÃª deve ter:

Uma camada de polÃ­gonos ou pontos (Camada_Estacoes_MG) representando suas estaÃ§Ãµes. Esta camada precisa ter campos que correspondam Ã  definiÃ§Ã£o em LYR_PZ_FLDS (ex: Codigo, Nome_Estacao, Endereco). O nome da estaÃ§Ã£o (Nome_Estacao) deve ser idÃªntico ao DC_NOME do CSV para o mapeamento funcionar.

Uma camada raster ou de polÃ­gonos (Camada_Suscetibilidade_MG) com um campo gridcode (ou similar) indicando os nÃ­veis de suscetibilidade.

Acesso Ã  API: Um token de acesso vÃ¡lido para a API do INMET.

## 4. ConfiguraÃ§Ã£o do CÃ³digo
Antes de executar, vocÃª precisa fazer os seguintes ajustes no seu notebook:

Token da API (Bloco 2): Na variÃ¡vel INMET_TOKEN, substitua "SEU_TOKEN_REAL_AQUI" pelo seu token.

Caminhos das Camadas (Bloco 2): Verifique e corrija os caminhos nas variÃ¡veis LYR_IN_PZ e LYR_IN_SZ para que apontem corretamente para suas camadas de estaÃ§Ãµes e suscetibilidade.

Campos da Camada de EstaÃ§Ãµes (Bloco 2): Verifique se os nomes dos campos na lista LYR_PZ_FLDS correspondem exatamente aos nomes dos campos na sua camada Camada_Estacoes_MG.

## 5. Como Executar
O cÃ³digo no notebook estÃ¡ dividido em 6 blocos sequenciais. Para executar a anÃ¡lise completa:

Abra seu projeto .aprx no ArcGIS Pro.

Abra o notebook associado ao projeto.

Execute cada cÃ©lula de cÃ³digo em ordem, do Bloco 1 ao Bloco 6.

## 6. Entendendo o Funcionamento do CÃ³digo (Bloco a Bloco)
Bloco 1: ImportaÃ§Ãµes

Carrega todas as bibliotecas Python necessÃ¡rias para o funcionamento do script (arcpy, pandas, logging, etc.).

Bloco 2: ConfiguraÃ§Ãµes Globais e Constantes

Define todas as variÃ¡veis fixas: URLs da API, seu token, caminhos para as pastas e geodatabases, e nomes das camadas e campos que serÃ£o usados. Ã‰ o principal local para ajustes.

Bloco 3: Leitura do CSV e CriaÃ§Ã£o do Mapa de EstaÃ§Ãµes

LÃª o arquivo estacoes_mg_completo.csv.

Cria um dicionÃ¡rio em memÃ³ria chamado MAP_ESTACAO_PARA_CODIGO_INMET. Este dicionÃ¡rio Ã© a "ponte" entre o nome da estaÃ§Ã£o na sua camada do mapa e o cÃ³digo oficial da estaÃ§Ã£o usado pela API do INMET.

Bloco 4: Estruturas de Dados e Templates

Prepara as listas (ARR_PZ, ARR_PD) e dicionÃ¡rios modelo que serÃ£o usados para armazenar temporariamente os dados coletados do mapa e da API antes de serem processados.

Bloco 5: DefiniÃ§Ã£o das FunÃ§Ãµes

ContÃ©m a "inteligÃªncia" do script, dividida em funÃ§Ãµes:

initialize(): Prepara o ambiente do ArcPy.

loadPluviometricZones(): LÃª sua camada de mapa (LYR_IN_PZ) para obter a geometria e o nome de cada estaÃ§Ã£o.

loadPluviometricData(): Itera sobre as estaÃ§Ãµes lidas, consulta a API do INMET para cada uma e busca os dados de chuva mais recentes.

loadNowData(): Organiza a junÃ§Ã£o dos dados geogrÃ¡ficos com os dados de chuva.

doAnalysis(): Executa as ferramentas de geoprocessamento do ArcGIS (Intersect, Calculate Field, Dissolve) para realizar a anÃ¡lise de risco.

nowcast(): Ã‰ a funÃ§Ã£o principal que "orquestra" a chamada das outras funÃ§Ãµes na ordem correta.

Bloco 6: ExecuÃ§Ã£o do Processo

Ã‰ o gatilho final. Chama a funÃ§Ã£o initialize() e depois a nowcast() para iniciar e executar todo o fluxo de trabalho descrito acima. Inclui tratamento de erros para capturar falhas.

## 7. SaÃ­da (Output)
Ao final da execuÃ§Ã£o, o script irÃ¡ gerar uma nova camada de polÃ­gonos dentro do seu geodatabase (MG-HIDRO-DATA.gdb). O nome da camada conterÃ¡ a data e hora da execuÃ§Ã£o (ex: MG_LHASA_N_20251001_1043). Esta camada mostrarÃ¡ as Ã¡reas com os respectivos nÃ­veis de perigo calculados ("BAIXO", "MODERADO", "ALTO", etc.). Se a opÃ§Ã£o OUTPUT_TO_SDE estiver ativa, os dados tambÃ©m serÃ£o gravados no SDE configurado.